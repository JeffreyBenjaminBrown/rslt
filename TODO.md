Use a parser -- ANTLR? pyPeg? Haskell?